<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Origami</title>
<link rel="stylesheet" href="Liquid1.css">
<link rel="stylesheet" href="Footer/footer.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
<div id="navbar-placeholder"></div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    fetch("Navbar/navbar.html")
      .then(res => {
        if (!res.ok) {
          throw new Error(`HTTP error! status: ${res.status}`);
        }
        return res.text();
      })
      .then(html => {
        document.getElementById("navbar-placeholder").innerHTML = html;
      })
      .catch(error => {
        console.error('Error loading navbar:', error);
        // Fallback: Insertar navbar directamente
        loadNavbarDirectly();
      });
  });

  function loadNavbarDirectly() {
    const navbarHTML = `
      <header class="header-bar">
        <h1 style="display:flex;align-items:center;gap:.5rem;margin:0;">
          <span class="logo-circle" aria-hidden="true"
            style="width:36px;height:36px;border-radius:50%;display:inline-block;background:url(img/Origami.jpeg) center/cover;overflow:hidden;">
          </span>
          <a href="Liquid1.html" style="text-decoration:none;color:inherit;">Origami</a>
        </h1>

        <nav class="nav-bar">
          <a href="Tienda.html">Tienda</a>
          <a href="Nosotros/nosotros.html">Nosotros</a>
          <div class="nav-search">
            <input id="search" class="nav-search__input" type="search" placeholder="Buscar…" />
            <label for="search" class="nav-search__btn">
              <i class="fa-solid fa-magnifying-glass"></i>
            </label>
          </div>
          <a href="auth/login.html" class="btn-login" aria-label="Iniciar sesión">
            <i class="fa-regular fa-user"></i>
            <span class="btn-login__label">Iniciar sesión</span>
          </a>
        </nav>
      </header>
    `;
    document.getElementById("navbar-placeholder").innerHTML = navbarHTML;
  }
</script>
  <main>
    <!--
    <section id="player" style="padding: 0; background: none; border: none; box-shadow: none; backdrop-filter: none;">
        <div class="music-player">
            <div class="music-player__album-art">
                <img src="https://lh3.googleusercontent.com/eenKvmISndioOoPoC0yNgDgn7CsIIS5JNsqcJn1RY6nNgeawxt2IpRlT-g10mVV1rCKXL5y38Ispcvdb=w544-h544-l90-rj" alt="Album Art">
            </div>
            <div class="music-player__info">
                <div class="music-player__song-title">All Of Me</div>
                <div class="music-player__artist">Nao</div>
            </div>
            <div class="music-player__controls">
                <i class="fa-solid fa-backward-step"></i>
                <i class="fa-solid fa-play"></i>
                <i class="fa-solid fa-forward-step"></i>
            </div>
        </div>
    </section>
    -->

    <section id="home-iphone" style="display:flex; flex-wrap:wrap; gap:1rem; align-items:flex-start; justify-content:center; overflow-x:visible;">
    <h2 style="flex-basis:100%; margin:0 0 1rem 0;">Ultimos IPhone</h2>
    <!-- Solo productos Apple desde backend -->
  </section>

    <section id="home-products" style="display:flex; flex-wrap:wrap; gap:1rem; align-items:flex-start; justify-content:center; overflow-x:visible;">
    <h2 style="flex-basis:100%; margin:0 0 1rem 0;">Últimos Productos</h2>
    <!-- Productos desde backend -->
  </section>
    <section id="info">
        <h2>SOMOS ORIGAMI</h2>
        <p style="font-size: 1.2rem; color: var(--text-muted-color); text-align: center;">Somos un emprendimiento enfocado en la importación y venta de productos tecnológicos, 
            insumos electrónicos y dispositivos móviles. 
            Ofrecemos atención personalizada, productos originales y precios accesibles.</p> </section>
  </main>

  <!-- <div id="nav" class="bottom-nav">
      <a href="#" class="bottom-nav__item active">
          <i class="fa-solid fa-house"></i>
          <span>Home</span>
      </a>
      <a href="#" class="bottom-nav__item">
          <i class="fa-solid fa-grip"></i>
          <span>New</span>
      </a>
      <a href="#" class="bottom-nav__item">
          <i class="fa-solid fa-tower-broadcast"></i>
          <span>Radio</span>
      </a>
      <a href="#" class="bottom-nav__item">
          <i class="fa-solid fa-book"></i>
          <span>Library</span>
      </a>
      <a href="#" class="bottom-nav__item bottom-nav__search-icon">
          <i class="fa-solid fa-magnifying-glass"></i>
      </a>
  </div>
-->
  <script src="js/store-integration.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
        const navItems = document.querySelectorAll('.bottom-nav__item');

        navItems.forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                if (!this.classList.contains('bottom-nav__search-icon')) {
                    navItems.forEach(nav => {
                        if (!nav.classList.contains('bottom-nav__search-icon')) {
                            nav.classList.remove('active');
                        }
                    });
                    this.classList.add('active');
                }
            });
        });

        const backgroundImages = [
            'https://assets.codepen.io/252820/unsplash-mountain3.webp',
        ];

        let currentImageIndex = 0;
        const body = document.body;

        function changeBackground() {
            const nextImage = new Image();
            const nextImageIndex = (currentImageIndex + 1) % backgroundImages.length;
            nextImage.src = backgroundImages[nextImageIndex];

            body.style.backgroundImage = `url('${backgroundImages[currentImageIndex]}')`;
            
            currentImageIndex = nextImageIndex;
        }

        changeBackground();

     

        // Render dinámico de productos desde backend
        (async function loadHomeProducts(){
          try {
            if (typeof axios === 'undefined') {
              const script = document.createElement('script');
              script.src = 'https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js';
              await new Promise((resolve, reject) => { script.onload = resolve; script.onerror = reject; document.head.appendChild(script); });
            }
            const res = await axios.get('/api/Producto');
            const products = Array.isArray(res.data) ? res.data : [];
            const container = document.getElementById('home-products');
            const iphoneContainer = document.getElementById('home-iphone');
            container.innerHTML = '';
            iphoneContainer.innerHTML = '<h2 style="flex-basis:100%; margin:0 0 1rem 0;">Ultimos IPhone</h2>';

            const cards = products.slice(0, 12).map(p => {
              const basePrice = (p.variantes && p.variantes.length) ? Math.min(...p.variantes.map(v => v.precio)) : null;
              const priceText = basePrice != null ? `$${basePrice}` : '';
              const imgBase64 = p.img || p.Img;
              const img = imgBase64 ? `data:image/png;base64,${imgBase64}` : 'img/Origami.jpeg';
              const productId = p.id ?? p.Id;

              const a = document.createElement('a');
              a.href = `Publi.html?id=${productId}`;
              a.style.textDecoration = 'none';
              a.style.color = 'inherit';

              const card = document.createElement('div');
              card.className = 'glass-effect card';
              card.style.flex = '0 0 260px';
              card.style.minHeight = '200px';
              card.style.padding = '1.5rem';
              card.style.borderRadius = 'var(--medium-radius)';

              const h3 = document.createElement('h3');
              h3.textContent = `${p.Marca || p.marca || ''} ${p.Modelo || p.modelo || ''}`.trim() || (p.Modelo || p.modelo || 'Producto');

              const fig = document.createElement('figure');
              fig.className = 'card__media';
              const image = document.createElement('img');
              image.src = img;
              image.alt = 'Producto';
              image.loading = 'lazy';
              fig.appendChild(image);

              const pDesc = document.createElement('p');
              pDesc.textContent = p.Categoria || p.categoria || '';

              const price = document.createElement('div');
              price.className = 'card__price';
              price.textContent = priceText;

              card.appendChild(h3);
              card.appendChild(fig);
              card.appendChild(pDesc);
              card.appendChild(price);
              a.appendChild(card);
              return a;
            });

            if (cards.length === 0) {
              const empty = document.createElement('div');
              empty.className = 'glass-effect';
              empty.style.padding = '1rem';
              empty.textContent = 'No hay productos disponibles.';
              container.appendChild(empty);
            } else {
              cards.forEach(c => container.appendChild(c));
            }

            // iPhone (Apple) únicamente
            const appleCards = products.filter(p => (p.Marca || p.marca || '').toLowerCase() === 'apple')
              .slice(0, 12)
              .map(p => {
                const basePrice = (p.variantes && p.variantes.length) ? Math.min(...p.variantes.map(v => v.precio)) : null;
                const priceText = basePrice != null ? `$${basePrice}` : '';
                const imgBase64 = p.img || p.Img;
                const img = imgBase64 ? `data:image/png;base64,${imgBase64}` : 'img/Origami.jpeg';
                const productId = p.id ?? p.Id;

                const a = document.createElement('a');
                a.href = `Publi.html?id=${productId}`;
                a.style.textDecoding = 'none';
                a.style.color = 'inherit';

                const card = document.createElement('div');
                card.className = 'glass-effect card';
                card.style.flex = '0 0 260px';
                card.style.minHeight = '200px';
                card.style.padding = '1.5rem';
                card.style.borderRadius = 'var(--medium-radius)';

                const h3 = document.createElement('h3');
                h3.textContent = `${p.Marca || p.marca || ''} ${p.Modelo || p.modelo || ''}`.trim() || (p.Modelo || p.modelo || 'Producto');

                const fig = document.createElement('figure');
                fig.className = 'card__media';
                const image = document.createElement('img');
                image.src = img; image.alt = 'Producto'; image.loading = 'lazy';
                fig.appendChild(image);

                const pDesc = document.createElement('p');
                pDesc.textContent = p.Categoria || p.categoria || '';

                const price = document.createElement('div');
                price.className = 'card__price';
                price.textContent = priceText;

                card.appendChild(h3);
                card.appendChild(fig);
                card.appendChild(pDesc);
                card.appendChild(price);
                a.appendChild(card);
                return a;
              });
            if (appleCards.length === 0) {
              const empty = document.createElement('div');
              empty.className = 'glass-effect';
              empty.style.padding = '1rem';
              empty.textContent = 'No hay productos Apple disponibles.';
              iphoneContainer.appendChild(empty);
            } else {
              appleCards.forEach(c => iphoneContainer.appendChild(c));
            }
          } catch (e) {
            console.error('Error cargando productos del backend:', e);
          }
        })();
    });
  </script> 
  <script src="js/cart.js"></script>
  <script>
    // Botón flotante para volver al panel si el admin está autenticado
    (async function addReturnToAdminIfAuthenticated() {
      try {
        // Cargar axios si no está disponible (ya se usa en admin, pero aquí puede no estar)
        if (typeof axios === 'undefined') {
          const script = document.createElement('script');
          script.src = 'https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js';
          await new Promise((resolve, reject) => { script.onload = resolve; script.onerror = reject; document.head.appendChild(script); });
        }

        const res = await axios.get('/Admin/verify', { withCredentials: true });
        if (res?.data?.isAuthenticated) {
          const btn = document.createElement('a');
          btn.href = '/admin/dashboard.html';
          btn.setAttribute('aria-label', 'Volver al panel de administración');
          btn.style.position = 'fixed';
          btn.style.bottom = '20px';
          btn.style.right = '20px';
          btn.style.zIndex = '10000';
          btn.style.padding = '0.8rem 1rem';
          btn.style.borderRadius = '999px';
          btn.style.background = 'rgba(255,255,255,0.15)';
          btn.style.backdropFilter = 'blur(10px)';
          btn.style.border = '1px solid rgba(255,255,255,0.25)';
          btn.style.color = '#fff';
          btn.style.textDecoration = 'none';
          btn.style.display = 'flex';
          btn.style.alignItems = 'center';
          btn.style.gap = '.5rem';
          btn.innerHTML = '<i class="fa-solid fa-gauge"></i> Volver al Panel';
          document.body.appendChild(btn);
        }
      } catch (e) {
        // Usuario no autenticado, no mostrar botón
      }
    })();
  </script>
  <div id="footer-placeholder"></div>
  <script>
   fetch("Footer/footer.html").then(r=>r.text()).then(html=>{
     document.getElementById("footer-placeholder").innerHTML = html;
   });
 </script>
</body>
</html>